/******************************************************************************
 ******************************************************************************
 **                                                                          **
 **                          ファイルヘッダー                                  **
 **                          File: system_config.cpp                         **
 **                                                                          **
 ******************************************************************************
 ******************************************************************************/

/******************************************************************************
 *                                                                            *
 *                              ライブラリ読み込み                             *
 *                                                                            *
 ******************************************************************************/
#include "system_config.h"

#include "../bsw/io/b_io.h"
#include "../bsw/io/b_io_t.h"
#include "../devices/led/led.h"
#include "../devices/switch/switch.h"

/******************************************************************************
 *                                                                            *
 *                              内部定数                                      *
 *                                                                            *
 ******************************************************************************/

/*============================================================================*
 *                            入力ピン番号                                    *
 *============================================================================*/
#define SWITCH_ST_SW_PIN 28

/*============================================================================*
 *                            出力ピン番号                                    *
 *============================================================================*/
#define LED_STATUS_PIN 30
#define LED_MORSE_PIN 31

// シリアル通信ボーレート
#define SERIAL_BAUD_RATE 115200

/******************************************************************************
 *                                                                            *
 *                              システム設定初期化関数                         *
 *                                                                            *
 ******************************************************************************/
global_err_t systemConfigInit() {
  /*----------------------------------------------------------------------------*
   *                          モールスLED初期化                                 *
   *----------------------------------------------------------------------------*/
  bio_output_device_t* ledMorseDevice = createLedOutputDevice(LED_MORSE_PIN, LED_MORSE);
  if (ledMorseDevice == nullptr) {
    return GLOBAL_ERR_INITIALIZATION_FAILED;
  }
  ledMorseDevice->ops->init(ledMorseDevice->ctx);

  /*----------------------------------------------------------------------------*
   *                          ステータスLED初期化                               *
   *----------------------------------------------------------------------------*/
  bio_output_device_t* ledStatusDevice = createLedOutputDevice(LED_STATUS_PIN, LED_STATUS);
  if (ledStatusDevice == nullptr) {
    return GLOBAL_ERR_INITIALIZATION_FAILED;
  }
  ledStatusDevice->ops->init(ledStatusDevice->ctx);

  /*----------------------------------------------------------------------------*
   *                          スイッチ初期化                                    *
   *----------------------------------------------------------------------------*/
  bio_input_device_t* switchDevice = createSwitchInputDevice(SWITCH_ST_SW_PIN, ST_SW);
  if (switchDevice == nullptr) {
    return GLOBAL_ERR_INITIALIZATION_FAILED;
  }
  switchDevice->ops->init(switchDevice->ctx);

  /*----------------------------------------------------------------------------*
   *                          デバイス登録                                      *
   *----------------------------------------------------------------------------*/
  bswRegisterOutputDevice(ledMorseDevice);
  bswRegisterOutputDevice(ledStatusDevice);
  bswRegisterInputDevice(switchDevice);

  /*----------------------------------------------------------------------------*
   *                          タスク初期化（未実装）                            *
   *----------------------------------------------------------------------------*/
  /* TODO: 全タスクの初期化処理をここで実行する */

  return GLOBAL_OK;
}